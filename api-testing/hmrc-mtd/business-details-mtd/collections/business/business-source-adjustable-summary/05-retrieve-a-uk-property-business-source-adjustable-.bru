meta {
  name: Retrieve a UK Property Business Source Adjustable Summary
  type: http
  seq: 5
}

get {
  url: {{base_url}}/individuals/self-assessment/adjustable-summary/{{nino}}/uk-property/{{calculationId}}/{{taxYear}}
  auth: none
}

headers {
  Accept: application/vnd.hmrc.7.0+json
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Retrieve a UK Property Business Source Adjustable Summary
  
  This endpoint allows the user to request a specific Business Source Adjustable Summary for a UK property business 
Furnished Holiday Letting (FHL) or a UK property. A National Insurance number and Calculation id must be 
provided.

### Test data
Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

|  Tax Year                    | Header Value (Gov-Test-Scenario)                | Scenario                                                                                                                                  |
| -----------------------------|-------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| All                          | N/A - DEFAULT                                   |  Simulates the scenario where no data is found.                                                                                           |
| All                          | TAX_YEAR_NOT_SUPPORTED                          |  Simulates the scenario where the tax year is not supported.                                                                              |
| All                          | REQUEST_CANNOT_BE_FULFILLED                     |  Simulates the scenario where the request cannot be fulfilled for various reasons other than the ones triggering other errors             |
| All                          | UK_PROPERTY_STATUS_INVALID                      |  Simulates success response with summary status invalid.                                                                                  |
| All                          | DYNAMIC_UK_PROPERTY_STATUS_INVALID              |  Simulates success response with summary status invalid. See below for details about dynamic scenarios.                                   |
| All                          | UK_PROPERTY_STATUS_SUPERSEDED                   |  Simulates success response with summary status superseded.                                                                               |
| All                          | DYNAMIC_UK_PROPERTY_STATUS_SUPERSEDED           |  Simulates success response with summary status superseded. See below for details about dynamic scenarios.                                |
| All                          | NOT_UK_PROPERTY                                 |  Simulates the scenario where the calculationId is not a UK property.                                                                     |
| All                          | STATEFUL                                        |  Performs a stateful retrieve.                                                                                                            |
| All                          | UK_PROPERTY_PROFIT                              |  Simulates success response with uk property and profit.                                                                                  |
| All                          | DYNAMIC_UK_PROPERTY_PROFIT                      |  Simulates success response with uk property and profit. onwards See below for details about dynamic scenarios.                           |
| All                          | UK_PROPERTY_LOSS                                |  Simulates success response with uk property and loss.                                                                                    |
| All                          | DYNAMIC_UK_PROPERTY_LOSS                        |  Simulates success response with uk property and loss. onwards See below for details about dynamic scenarios.                             |
| All                          | UK_PROPERTY_CONSOLIDATED                        |  Simulates success response with adjusted summary and consolidated expenses.                                                              |
| All                          | DYNAMIC_UK_PROPERTY_CONSOLIDATED                |  Simulates success response with adjusted summary and consolidated expenses. onwards See below for details about dynamic scenarios.       |
| All                          | UK_PROPERTY_ALLOWANCE                           |  Simulates success response with adjusted summary and propertyAllowance.                                                                  |
| All                          | DYNAMIC_UK_PROPERTY_ALLOWANCE                   |  Simulates success response with adjusted summary and propertyAllowance. onwards See below for details about dynamic scenarios.           |
| Before 2025-26               | UK_PROPERTY_FHL_PROFIT                          |  Simulates success response with uk property FHL and profit.                                                                              |
| Before 2025-26               | DYNAMIC_UK_PROPERTY_FHL_PROFIT                  |  Simulates success response with uk property FHL and profit. See below for details about dynamic scenarios.                               |
| Before 2025-26               | UK_PROPERTY_FHL_LOSS                            |  Simulates success response with uk property FHL and loss.                                                                                |
| Before 2025-26               | DYNAMIC_UK_PROPERTY_FHL_LOSS                    |  Simulates success response with uk property FHL and loss. See below for details about dynamic scenarios.                                 |
| Before 2025-26               | UK_PROPERTY_FHL_CONSOLIDATED                    |  Simulates success response with FHL adjusted summary and consolidated expenses.                                                          |
| Before 2025-26               | DYNAMIC_UK_PROPERTY_FHL_CONSOLIDATED            |  Simulates success response with FHL adjusted summary and consolidated expenses.See below for details about dynamic scenarios.            |
| Before 2025-26               | UK_FHL_PROPERTY_ALLOWANCE                       |  Simulates success response with FHL adjusted summary and propertyAllowance.                                                              |
| Before 2025-26               | DYNAMIC_UK_FHL_PROPERTY_ALLOWANCE               |  Simulates success response with FHL adjusted summary and propertyAllowance. See below for details about dynamic scenarios.               |
| 2024-25 Onwards              | UK_PROPERTY_ZERO_ADJUSTMENTS                    |  Simulates the scenario where all income and expenses have zero adjustments.                                                              |



In each case where a scenario is prefixed by DYNAMIC_, the following response values will change based on the values submitted in the request:
  - metadata
    - calculationId
    - taxYear
    - nino
    - requestedDateTime
    - adjustedDateTime
  - inputs
    - accountingPeriodStartDate
    - accountingPeriodEndDate
    - submissionPeriods
      - startDate
      - endDate

  
  API: Business Source Adjustable Summary
}
