meta {
  name: Amend a Brought Forward Loss Amount
  type: http
  seq: 2
}

post {
  url: {{base_url}}/individuals/losses/{{nino}}/brought-forward-losses/{{lossId}}/tax-year/{{taxYear}}/change-loss-amount
  body: json
  auth: none
}

headers {
  Accept: application/vnd.hmrc.6.0+json
  Content-Type: {{Content-Type}}
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Amend a Brought Forward Loss Amount
  
  This endpoint enables you to update an existing brought forward loss amount.
A National Insurance number, tax year and Loss ID must be provided.

<strong>
  Note: Brought forward losses for the following 2 income sources will not be supported from tax year 2025-26 onwards:
    <ul>
      <li>uk-property-fhl</li>
      <li>foreign-property-fhl-eea</li>
    </ul>
</strong>

### Test data
Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.    

| Header Value (Gov-Test-Scenario)  | Scenario                                                                                                                            |
|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| N/A - DEFAULT                     | Simulates success response where type of loss is Self-Employment.                                                                   |
| CLASS_4                           | Simulates the scenario where type of loss is Self-Employment Class 4.                                                               |
| FOREIGN_PROPERTY                  | Simulates the scenario where type of loss is Foreign Property.                                                                      |
| FOREIGN_PROPERTY_FHL_EEA          | Simulates the scenario where type of loss is Foreign Property FHL EEA.                                                              |
| UK_PROPERTY_FHL                   | Simulates the scenario where type of loss is UK Property FHL.                                                                       |
| UK_PROPERTY                       | Simulates the scenario where type of loss is UK Property (Non-FHL).                                                                 |
| NOT_FOUND                         | Simulates the scenario where no data is found.                                                                                      |
| NO_CHANGE                         | Simulates the scenario where the brought forward loss amount has not changed.                                                       |
| OUTSIDE_AMENDMENT_WINDOW          | Simulates the scenario where request cannot be completed as it is outside the amendment window.                                     |
| DYNAMIC                           | The following response values will change to correspond to the values submitted in the request:<br> • lossAmount<br> • lastModified |
| STATEFUL                          | Performs a stateful update.                                                                                                         |

  
  API: Individual Losses
}
