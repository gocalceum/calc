meta {
  name: Retrieve a Self Assessment Tax Calculation [test only]
  type: http
  seq: 3
}

get {
  url: {{base_url}}/individuals/calculations/{{nino}}/self-assessment/{{taxYear}}/{{calculationId}}
  auth: none
}

headers {
  Accept: application/vnd.hmrc.8.0+json
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Retrieve a Self Assessment Tax Calculation [test only]
  
  This endpoint allows the developer to retrieve all the tax calculation data 
for a given National Insurance number and Calculation ID.

Note: if the calculation has been triggered recently and has not yet completed, this endpoint will return 404 Not Found.

### Test data
Scenario simulations using `Gov-Test-Scenario` headers is only available in the sandbox environment.

| Header Value (Gov-Test-Scenario)   | Scenario                                                                           |
|------------------------------------|------------------------------------------------------------------------------------|
| N/A - DEFAULT                      | Simulates success response.                                                        |
| NOT_FOUND                          | Simulates the scenario where no data is found.                                     |
| ERROR_MESSAGES_EXIST               | Simulates the scenario where errors exist and no calculation has been generated.  |
| UK_MULTIPLE_INCOMES_EXAMPLE        | Simulates an example tax calculation for a UK FHL Property business with Savings and Dividends. |
| UK_PROP_DIVIDENDS_EXAMPLE          | Simulates an example tax calculation for a UK Property (Non-FHL) business with Dividends. |
| UK_PROP_GIFTAID_EXAMPLE            | Simulates an example tax calculation for a UK Property (Non-FHL) business with Gift Aid. |
| UK_PROP_SAVINGS_EXAMPLE            | Simulates an example tax calculation for a UK Property (Non-FHL) business with Savings. |
| UK_SE_GIFTAID_EXAMPLE              | Simulates an example tax calculation for a UK Self-Employment business with Gift Aid. |
| UK_SE_SAVINGS_EXAMPLE              | Simulates an example tax calculation for a UK Self-Employment business with Savings. |
| SCOT_SE_DIVIDENDS_EXAMPLE          | Simulates an example tax calculation for a Scottish Self-Employment business with Dividends. |
| DYNAMIC                            | The date fields in the response are made dynamic based on the tax year passed within the request.<br><br/> The dynamic response will work for tax years (taxYear) starting 2023-24 onwards. For any previous tax years supplied, it will result in a HTTP 400 (RULE_INCORRECT_GOV_TEST_SCENARIO) error being returned. |

  
  API: Individual Calculations
}
