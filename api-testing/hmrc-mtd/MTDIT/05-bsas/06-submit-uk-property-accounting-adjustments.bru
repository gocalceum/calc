meta {
  name: Submit UK Property Accounting Adjustments
  type: http
  seq: 6
}

post {
  url: {{base_url}}/individuals/self-assessment/adjustable-summary/{{nino}}/uk-property/{{calculationId}}/adjust/{{taxYear}}
  body: json
  auth: none
}

headers {
  Accept: application/vnd.hmrc.7.0+json
  Content-Type: {{Content-Type}}
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Submit UK Property Accounting Adjustments
  
  This endpoint allows the user to provide accounting adjustments against a specified Business Source Accounting
Summary quoting its unique identifier. The calculation ID quoted must be for a UK Property Business, and it must not
have been adjusted previously. Only data for one property business (either FHL or Non-FHL) should be included in any
submission. A National Insurance number and calculation ID must be provided.

### Test data
Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

| Header Value (Gov-Test-Scenario)                 | Scenario                                                                                                                     |
|--------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|
| N/A - DEFAULT                                    | Simulates success response.                                                                                                  |
| TYPE_OF_BUSINESS_INCORRECT                       | Simulates the scenario where the calculation ID supplied does not relate to a UK property business.                          |
| SUMMARY_STATUS_INVALID                           | Simulates the scenario where the summary is invalid and cannot be adjusted.                                                  |
| SUMMARY_STATUS_SUPERSEDED                        | Simulates the scenario where the summary is superseded and cannot be adjusted.                                               |
| ALREADY_ADJUSTED                                 | Simulates the scenario where the summary has already been adjusted.                                                          |
| RESULTING_VALUE_NOT_PERMITTED                    | Simulates the scenario where one or more adjustments would result in a negative value that is not permitted.                 |
| UK_PROPERTY_OVER_CONSOLIDATED_EXPENSES_THRESHOLD | Simulates the scenario where the cumulative turnover amount exceeds the consolidated expenses threshold.                     |
| UK_PROPERTY_INCOME_ALLOWANCE_CLAIMED             | Simulates the scenario where property income allowance was claimed but the adjustment was made to expenses.                  |
| OUTSIDE_AMENDMENT_WINDOW                         | Simulates the scenario where request cannot be completed as it is outside the amendment window.                              |
| NOT_FOUND                                        | Simulates the scenario where no data is found.                                                                               |
| TAX_YEAR_NOT_SUPPORTED                           | Simulates the scenario where the tax year is not supported.                                                                  |
| REQUEST_CANNOT_BE_FULFILLED                      | Simulates the scenario where the request cannot be fulfilled for various reasons other than the ones triggering other errors.|
| STATEFUL                                         | Performs a stateful submit.                                                                                                  |

  
  API: Business Source Adjustable Summary
}
