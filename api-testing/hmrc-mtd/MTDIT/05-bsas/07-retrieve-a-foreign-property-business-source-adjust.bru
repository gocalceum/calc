meta {
  name: Retrieve a Foreign Property Business Source Adjustable Summary
  type: http
  seq: 7
}

get {
  url: {{base_url}}/individuals/self-assessment/adjustable-summary/{{nino}}/foreign-property/{{calculationId}}/{{taxYear}}
  auth: none
}

headers {
  Accept: application/vnd.hmrc.7.0+json
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Retrieve a Foreign Property Business Source Adjustable Summary
  
  This endpoint enables you to request a specific Business Source Adjustable Summary for a foreign property 
business EEA Furnished Holiday Letting (FHL) or a non-FHL foreign property business. A National Insurance number and
calculation ID must be provided. 

Please note that the expense items 'residentialFinancialCost' and 'broughtFwdResidentialFinancialCost' under 
'adjustableSummaryCalculation' and 'adjustedSummaryCalculation' are not currently in use and will not be returned 
in a live environment. These fields will be removed in the near future.

### Test data
Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.  
 
|  Tax Year                    | Header Value (Gov-Test-Scenario)              | Scenario                                                                                                                                 |
| -----------------------------| --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| All                          | N/A - DEFAULT                                 | Simulates the scenario where no data is found.                                                                                           |
| All                          | FOREIGN_PROPERTY_STATUS_INVALID               | Simulates success response with summary status invalid.                                                                                  |
| All                          | DYNAMIC_FOREIGN_PROPERTY_STATUS_INVALID       | Simulates success response with summary status invalid. <br><br> See below for details on DYNAMIC scenarios.                             |
| All                          | FOREIGN_PROPERTY_STATUS_SUPERSEDED            | Simulates success response with summary status superseded.                                                                               |
| All                          | DYNAMIC_FOREIGN_PROPERTY_STATUS_SUPERSEDED    | Simulates success response with summary status superseded. <br><br> See below for details on DYNAMIC scenarios.                          | 
| All                          | REQUEST_CANNOT_BE_FULFILLED                   | Simulates the scenario where the request cannot be fulfilled for various reasons other than the ones triggering other errors.            |
| All                          | STATEFUL                                      | Performs a stateful retrieve.                                                                                                            |
| All                          | FOREIGN_PROPERTY_PROFIT                       | Simulates success response foreign property and profit.                                                                                  |
| All                          | DYNAMIC_FOREIGN_PROPERTY_PROFIT               | Simulates success response foreign property and profit. <br><br> See below for details on DYNAMIC scenarios.                             |
| All                          | FOREIGN_PROPERTY_LOSS                         | Simulates success response FHL foreign property and loss.                                                                                |
| All                          | DYNAMIC_FOREIGN_PROPERTY_LOSS                 | Simulates success response foreign property and loss. <br><br> See below for details on DYNAMIC scenarios.                               |
| All                          | FOREIGN_PROPERTY_CONSOLIDATED                 | Simulates success response adjusted summary and consolidated expenses.                                                                   |
| All                          | DYNAMIC_FOREIGN_PROPERTY_CONSOLIDATED         | Simulates success response adjusted summary and consolidated expenses.  <br><br> See below for details on DYNAMIC scenarios.             |
| All                          | FOREIGN_PROPERTY_ALLOWANCE                    | Simulates success response adjusted summary and propertyAllowance.                                                                       |
| All                          | DYNAMIC_FOREIGN_PROPERTY_ALLOWANCE            | Simulates success response adjusted summary and propertyAllowance. <br><br> See below for details on DYNAMIC scenarios.                  |    
| Before 2025-26               | FOREIGN_PROPERTY_FHL_PROFIT                   | Simulates success response with FHL foreign property and profit.                                                                         |
| Before 2025-26               | DYNAMIC_FOREIGN_PROPERTY_FHL_PROFIT           | Simulates success response with FHL foreign property and profit. <br><br> See below for details on DYNAMIC scenarios.                    |
| Before 2025-26               | FOREIGN_PROPERTY_FHL_LOSS                     | Simulates success response with FHL foreign property and loss.                                                                           |
| Before 2025-26               | DYNAMIC_FOREIGN_PROPERTY_FHL_LOSS             | Simulates success response with FHL foreign property and loss.  <br><br> See below for details on DYNAMIC scenarios.                     |    
| Before 2025-26               | FOREIGN_PROPERTY_FHL_CONSOLIDATED             | Simulates success response with FHL adjusted summary and consolidated expenses.                                                          |
| Before 2025-26               | DYNAMIC_FOREIGN_PROPERTY_FHL_CONSOLIDATED     | Simulates success response with FHL adjusted summary and consolidated expenses.  <br><br> See below for details on DYNAMIC scenarios.    |
| Before 2025-26               | FOREIGN_FHL_PROPERTY_ALLOWANCE                | Simulates success response with FHL adjusted summary and propertyAllowance.                                                              |
| Before 2025-26               | DYNAMIC_FOREIGN_FHL_PROPERTY_ALLOWANCE        | Simulates success response with FHL adjusted summary and propertyAllowance. <br><br> See below for details on DYNAMIC scenarios.         |
| 2024-25 onwards              | FOREIGN_PROPERTY_ZERO_ADJUSTMENTS             | Simulates the scenario where all income, expenses and additions have zero adjustments.                                                   |

In each case where a scenario is prefixed by DYNAMIC_, the following response values will change based on the values submitted in the request:
  * metadata
    * calculationId
    * taxYear
    * nino
    * requestedDateTime
    * adjustedDateTime
  * inputs
    * accountingPeriodStartDate
    * accountingPeriodEndDate
    * submissionPeriods
      * startDate
      * endDate
      * receivedDateTime

  For tax years prior to 2023-24, when the tax year is not supplied, these values will be based on a tax year of 2022-23.

  
  API: Business Source Adjustable Summary
}
