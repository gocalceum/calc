meta {
  name: Trigger a Business Source Adjustable Summary
  type: http
  seq: 2
}

post {
  url: {{base_url}}/individuals/self-assessment/adjustable-summary/{{nino}}/trigger
  body: json
  auth: none
}

headers {
  Accept: application/vnd.hmrc.7.0+json
  Content-Type: {{Content-Type}}
  Authorization: Bearer {{access_token}}
}

script:pre-request {
  // Add Gov-Test-Scenario header if set
  const scenario = bru.getVar('Gov-Test-Scenario');
  if (scenario && scenario.trim() !== '') {
    req.setHeader('Gov-Test-Scenario', scenario);
  }
}

tests {
  test("Should return success", function() {
    expect(res.status).to.be.oneOf([200, 201, 204]);
  });
}

docs {
  ## Trigger a Business Source Adjustable Summary
  
  This endpoint allows a developer to generate an end of accounting period Business Source Adjustable Summary of the 
income and expenditure for a specified business for a given accounting period. A Business Source Adjustable Summary 
must be generated before accounting adjustments are to be entered. A National Insurance number must be provided.

### Test data
Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.  

|Tax year        | Header Value (Gov-Test-Scenario) | Scenario                                                                                                                     |
|----------------|----------------------------------|------------------------------------------------------------------------------------------------------------------------------|
|ALL             | N/A - DEFAULT                    | Simulates success response.                                                                                                  |
|ALL             | NO_ACCOUNTING_PERIOD             | Simulates the scenario where the supplied accounting period does not exist.                                                  |
|ALL             | OBLIGATIONS_NOT_MET              | Simulates the scenario where obligations for the business have not been met.                                                 |
|ALL             | ACCOUNTING_PERIOD_NOT_ENDED      | Simulates the scenario where the supplied accounting period has not ended.                                                   |
|2025-26 onwards | OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window.                              |
|ALL             | NOT_FOUND                        | Simulates the scenario where no data is found.                                                                               |
|ALL             | TAX_YEAR_NOT_SUPPORTED           | Simulates the scenario where the tax year is not supported.                                                                  |
|ALL             | REQUEST_CANNOT_BE_FULFILLED      | Simulates the scenario where the request cannot be fulfilled for various reasons other than the ones triggering other errors.|
|ALL             | STATEFUL                         | Performs a stateful trigger.                                                                                                 |

  
  API: Business Source Adjustable Summary
}
