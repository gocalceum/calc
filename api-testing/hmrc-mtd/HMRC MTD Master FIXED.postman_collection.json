{
	"info": {
		"_postman_id": "99b29e88-8c6d-4663-8bd3-7f4dd9e509c0",
		"name": "HMRC MTD Master FIXED",
		"description": "Fixed collection with correct fraud headers",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "47400546",
		"_collection_link": "https://bhalcrow78-9424527.postman.co/workspace/Calceum's-Workspace~bbfbc3d2-c64f-4fbc-881e-46243e3a45ec/collection/47400546-99b29e88-8c6d-4663-8bd3-7f4dd9e509c0?action=share&source=collection_link&creator=47400546"
	},
	"item": [
		{
			"name": "Test Fraud Headers",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/test/fraud-prevention-headers/validate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"test",
						"fraud-prevention-headers",
						"validate"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create Test User",
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/vnd.hmrc.1.0+json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"serviceNames\":[\"self-assessment\",\"mtd-income-tax\"]}"
				},
				"url": {
					"raw": "https://test-api.service.hmrc.gov.uk/create-test-user/individuals",
					"protocol": "https",
					"host": [
						"test-api",
						"service",
						"hmrc",
						"gov",
						"uk"
					],
					"path": [
						"create-test-user",
						"individuals"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "oauth2",
		"oauth2": [
			{
				"key": "clientSecret",
				"value": "{{client_secret}}",
				"type": "string"
			},
			{
				"key": "clientId",
				"value": "{{client_id}}",
				"type": "string"
			},
			{
				"key": "scope",
				"value": "read:self-assessment write:self-assessment",
				"type": "string"
			},
			{
				"key": "accessTokenUrl",
				"value": "https://test-api.service.hmrc.gov.uk/oauth/token",
				"type": "string"
			},
			{
				"key": "authUrl",
				"value": "https://test-api.service.hmrc.gov.uk/oauth/authorize",
				"type": "string"
			},
			{
				"key": "redirect_uri",
				"value": "https://oauth.pstmn.io/v1/callback",
				"type": "string"
			},
			{
				"key": "grant_type",
				"value": "authorization_code",
				"type": "string"
			},
			{
				"key": "tokenName",
				"value": "HMRC MTD Token",
				"type": "string"
			},
			{
				"key": "addTokenTo",
				"value": "header",
				"type": "string"
			},
			{
				"key": "client_authentication",
				"value": "body",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// HMRC Fraud Prevention Headers - FIXED VERSION",
					"const timestamp = new Date().toISOString();",
					"let deviceId = pm.environment.get('device_id');",
					"if (!deviceId) {",
					"    deviceId = pm.variables.replaceIn('{{$guid}}');",
					"    pm.environment.set('device_id', deviceId);",
					"}",
					"",
					"// Define IPs",
					"const clientIP = '86.189.45.123';",
					"const vendorIP = '203.0.113.42';",
					"",
					"// Add all headers",
					"const headers = [",
					"    ['Gov-Client-Connection-Method', 'WEB_APP_VIA_SERVER'],",
					"    ['Gov-Client-Device-ID', deviceId],",
					"    ['Gov-Client-User-IDs', 'my-accounting-software=testuser123'],",
					"    ['Gov-Client-Timezone', 'UTC+00:00'],",
					"    ['Gov-Client-Local-IPs', '192.168.1.1'],",
					"    ['Gov-Client-Local-IPs-Timestamp', timestamp],",
					"    ['Gov-Client-Public-IP', clientIP],",
					"    ['Gov-Client-Public-IP-Timestamp', timestamp],",
					"    ['Gov-Client-Public-Port', '12345'],",
					"    ['Gov-Client-Browser-JS-User-Agent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'],",
					"    ['Gov-Client-Screens', 'width=1920&height=1080&scaling-factor=1&colour-depth=24'],",
					"    ['Gov-Client-Window-Size', 'width=1920&height=1080'],",
					"    ['Gov-Vendor-Version', 'MyAccounting=1.0.0'],",
					"    ['Gov-Vendor-License-IDs', 'MyAccounting=1234567890'],",
					"    ['Gov-Vendor-Product-Name', 'MyAccounting'],",
					"    ['Gov-Vendor-Public-IP', vendorIP],",
					"    ['Gov-Vendor-Forwarded', 'by=' + vendorIP + '&for=' + clientIP],",
					"    ['Accept', 'application/vnd.hmrc.1.0+json'],",
					"    ['Gov-Client-Multi-Factor', '']",
					"];",
					"",
					"headers.forEach(([key, value]) => {",
					"    pm.request.headers.add({ key: key, value: value });",
					"});",
					"",
					"console.log('âœ… Headers added:', headers.length);",
					"console.log('Client IP:', clientIP);",
					"console.log('Vendor IP:', vendorIP);"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "https://test-api.service.hmrc.gov.uk",
			"type": "string"
		}
	]
}